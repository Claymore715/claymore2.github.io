<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>虚拟地址 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="实模式下的寻址方式“段基址+段偏移”的形式   虚拟地址是Windows程序时运行在386保护模式下，这样程序访问存储器所使用的逻辑地址称为虚拟地址   Windows 2000 使用基于分页机制的虚拟内存。每个进程有4GB的虚拟地址空间。基于分页机制，这4GB地址空间的一些部分被映射了物理内存，一些部分映射硬盘上的交换文件，一些部分什么也没有映射。程序中使用的都是4GB地址空间中的虚拟地址。而">
<meta property="og:type" content="article">
<meta property="og:title" content="虚拟地址">
<meta property="og:url" content="http://yoursite.com/2020/10/08/%E8%99%9A%E6%8B%9F%E5%9C%B0%E5%9D%80/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="实模式下的寻址方式“段基址+段偏移”的形式   虚拟地址是Windows程序时运行在386保护模式下，这样程序访问存储器所使用的逻辑地址称为虚拟地址   Windows 2000 使用基于分页机制的虚拟内存。每个进程有4GB的虚拟地址空间。基于分页机制，这4GB地址空间的一些部分被映射了物理内存，一些部分映射硬盘上的交换文件，一些部分什么也没有映射。程序中使用的都是4GB地址空间中的虚拟地址。而">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-10-08T11:59:26.000Z">
<meta property="article:modified_time" content="2020-10-08T12:24:30.652Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-虚拟地址" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/10/08/%E8%99%9A%E6%8B%9F%E5%9C%B0%E5%9D%80/" class="article-date">
  <time datetime="2020-10-08T11:59:26.000Z" itemprop="datePublished">2020-10-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      虚拟地址
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p> 实模式下的寻址方式“段基址+段偏移”的形式 </p>
<p> 虚拟地址是Windows程序时运行在386保护模式下，这样程序访问<a href="https://baike.baidu.com/item/存储器/1583185" target="_blank" rel="noopener">存储器</a>所使用的<a href="https://baike.baidu.com/item/逻辑地址/3283849" target="_blank" rel="noopener">逻辑地址</a>称为虚拟地址 </p>
<p> Windows 2000 使用基于<a href="https://baike.baidu.com/item/分页" target="_blank" rel="noopener">分页</a>机制的<a href="https://baike.baidu.com/item/虚拟内存" target="_blank" rel="noopener">虚拟内存</a>。每个进程有4GB的虚拟<a href="https://baike.baidu.com/item/地址空间" target="_blank" rel="noopener">地址空间</a>。基于分页机制，这4GB地址空间的一些部分被映射了<a href="https://baike.baidu.com/item/物理内存" target="_blank" rel="noopener">物理内存</a>，一些部分映射硬盘上的交换文件，一些部分什么也没有映射。程序中使用的都是4GB地址空间中的虚拟地址。而访问物理内存，需要使用<a href="https://baike.baidu.com/item/物理地址" target="_blank" rel="noopener">物理地址</a>。 </p>
<p><a href="https://baike.baidu.com/item/物理地址" target="_blank" rel="noopener"><strong>物理地址</strong></a> (physical address): 放在寻址总线上的地址。放在寻址总线上，如果是读，电路根据这个地址每位的值就将相应地址的<a href="https://baike.baidu.com/item/物理内存" target="_blank" rel="noopener">物理内存</a>中的数据放到<a href="https://baike.baidu.com/item/数据总线" target="_blank" rel="noopener">数据总线</a>中传输。如果是写，电路根据这个地址每位的值就在相应地址的物理内存中放入数据总线上的内容。物理内存是以<a href="https://baike.baidu.com/item/字节" target="_blank" rel="noopener">字节</a>(8位)为单位<a href="https://baike.baidu.com/item/编址" target="_blank" rel="noopener">编址</a>的。</p>
<p><strong>虚拟地址</strong> (virtual address): CPU启动保护模式后，程序运行在虚拟<a href="https://baike.baidu.com/item/地址空间" target="_blank" rel="noopener">地址空间</a>中。注意，并不是所有的“程序”都是运行在虚拟地址中。CPU在启动的时候是运行在实模式的，Bootloader以及内核在初始化页表之前并不使用虚拟地址，而是直接使用物理地址的。</p>
<p>如果CPU寄存器中的分页标志位被设置，那么执行内存操作的<a href="https://baike.baidu.com/item/机器指令" target="_blank" rel="noopener">机器指令</a>时，CPU（准确来说，是<a href="https://baike.baidu.com/item/MMU" target="_blank" rel="noopener">MMU</a>，即Memory Management Unit，内存管理单元）会自动根据页目录和<a href="https://baike.baidu.com/item/页表" target="_blank" rel="noopener">页表</a>中的信息，把虚拟地址转换成物理地址，完成该指令。</p>
<p> 如果是32位处理器，则内地址总线是32位的，与CPU执行单元相连（图中只是示意性地画了4条地址线），而经过MMU转换之后的外地址总线则不一定是32位的。也就是说，虚拟地址空间和物理地址空间是独立的，32位处理器的虚拟地址空间是4GB，而物理地址空间既可以大于也可以小于4GB。 </p>
<p>CPU通过地址来访问内存中的单元，地址有虚拟地址和物理地址之分，如果CPU没有MMU（Memory Management Unit，内存管理单元），或者有MMU但没有启用，CPU核在取指令或访问内存时发出的地址将直接传到CPU芯片的外部地址引脚上，直接被内存芯片（以下称为物理内存，以便与虚拟内存区分）接收，这称为物理地址（Physical Address，以下简称PA）</p>
<p>​                          </p>
<p>如果CPU启用了MMU，CPU核发出的地址将被MMU截获，从CPU到MMU的地址称为虚拟地址（Virtual Address，以下简称VA），而MMU将这个地址翻译成另一个地址发到CPU芯片的外部地址引脚上，也就是将虚拟地址映射成物理地址</p>
<p>​        虚拟内存：虚拟内存是一种逻辑上扩充物理内存的技术。基本思想是用软、硬件技术把内存与外存这两级存储器当做一级存储器来用。虚拟内存技术的实现利用了自动覆盖和交换技术。简单的说就是将硬盘的一部分作为内存来使用。</p>
<p>  虚拟地址空间：在32位的i386 CPU的地址总线的是32位的，也就是说可以寻找到4G的地址空间。我们的程序被CPU执行，就是在0x00000000到0xFFFFFFFF这一段地址中。高2G的空间为内核空间，由操作系统调用，低2G的空间为用户空间，由用户使用。</p>
<p>  CPU在寻址的时候，是按照虚拟地址来寻址，然后通过MMU(内存管理单元)将虚拟地址转换为物理地址。因为只有程序的一部分加入到内存中，所以会出现所寻找的地址不在内存中的情况（CPU产生缺页异常），如果在内存不足的情况下，就会通过页面调度算法来将内存中的页面置换出来，然后将在外存中的页面加入到内存中，使程序继续正常运行。</p>
<p> 可以看出，虚拟地址空间和虚拟内存的一个关键的因素是MMU（内存管理单元）。</p>
<p>  现在一个程序的执行现在可以分为3部分：</p>
<p>  1：CPU需要执行的语句的虚拟地址。</p>
<p>  2：程序装入内存的部分</p>
<p>  3：程序再外存中的部分</p>
<p>  因为CPU是通过时间片轮转的方法使不同的程序并发执行的。所以在某一时刻只有一个程序占据CPU资源，CPU的最大的寻址空间为4G，所以说可以将每个程序可以看做独立占据4G的内存（只是可以看成，但是它并没有占据实际的4G内存）。而CPU是将虚拟地址空间里面的代码执行，如果在内存中寻找不到所需要的页面，就需要到外存中寻找，外存的这一部分，我们可以当成内存来使用，这也就是虚拟内存。虚拟地址空间不等于虚拟内存。虚拟地址空间是一个空间，不是真正存在的，只是通过CPU的寻址虚拟出来的一个范围。而虚拟内存是实实在在的硬盘的空间。               </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/10/08/%E8%99%9A%E6%8B%9F%E5%9C%B0%E5%9D%80/" data-id="ckmdlisyq0006lsel58u6bkj3" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/10/24/%E5%89%AA%E6%A0%BC%E5%AD%90/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          剪格子
        
      </div>
    </a>
  
  
    <a href="/2020/09/26/C-std/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">C++ std</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/1/" rel="tag">1</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/1/" style="font-size: 10px;">1</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/03/17/Hill/">Hill</a>
          </li>
        
          <li>
            <a href="/2021/03/16/matrix/">matrix</a>
          </li>
        
          <li>
            <a href="/2020/11/22/tenserflow-python/">tenserflow+python</a>
          </li>
        
          <li>
            <a href="/2020/10/28/%E5%9B%BD%E7%8E%8B%E7%9A%84%E7%83%A6%E6%81%BC/">国王的烦恼</a>
          </li>
        
          <li>
            <a href="/2020/10/25/%E5%9C%B0%E5%AE%AB/">地宫</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>